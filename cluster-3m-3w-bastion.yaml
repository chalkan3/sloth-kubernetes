# Production Cluster with Bastion - 3 Masters + 3 Workers
# Masters: 2 Linode + 1 DigitalOcean
# Workers: 1 Linode + 2 DigitalOcean
metadata:
  name: production-cluster-3m3w
  environment: production
  version: "1.0.0"
  description: "Production Multi-Cloud Kubernetes with Bastion Host"

providers:
  digitalocean:
    enabled: true
    token: ${DIGITALOCEAN_TOKEN}
    region: nyc3
    vpc:
      create: true
      name: sloth-k8s-do-vpc
      cidr: 10.10.0.0/16
      description: "DigitalOcean VPC for Sloth Kubernetes v2"

  linode:
    enabled: true
    token: ${LINODE_TOKEN}
    region: us-ord
    vpc:
      create: true
      name: sloth-k8s-linode-vpc
      description: "Linode VPC for Sloth Kubernetes v2"
      linode:
        label: sloth-k8s-linode-vpc
        description: "Linode VPC for Sloth Kubernetes v2"
        subnets:
          - label: k8s-subnet
            ipv4: 10.11.0.0/24

network:
  mode: wireguard
  dns:
    domain: chalkan3.com.br
    provider: digitalocean
  wireguard:
    enabled: true
    create: true
    provider: linode
    region: us-ord
    size: g6-nanode-1
    name: wg-vpn-server
    port: 51820
    subnetCidr: 10.8.0.0/24
    meshNetworking: true
    allowedIPs:
      - 10.8.0.0/24
      - 10.10.0.0/16
      - 10.11.0.0/16

security:
  # BASTION HOST - Only bastion has public SSH access
  bastion:
    enabled: true
    provider: "linode"
    region: "us-ord"
    size: "g6-standard-2"
    image: "linode/ubuntu24.04"
    name: "bastion-prod"
    sshPort: 22
    vpnOnly: false
    allowedCIDRs:
      - "0.0.0.0/0"  # Allow from anywhere (restrict in production!)
    idleTimeout: 30
    maxSessions: 10
    enableAuditLog: false
    enableMFA: false
  ssh:
    enabled: true
    port: 22
    keyType: "ed25519"

kubernetes:
  distribution: k3s
  version: v1.28.5+k3s1
  podCidr: 10.42.0.0/16
  serviceCidr: 10.43.0.0/16
  clusterDns: 10.43.0.10
  networkPlugin: calico
  rke2:
    channel: stable
    clusterToken: "my-super-secret-cluster-token-rke2-production-2025"
    tlsSan:
      - kubernetes.sloth.local
    disableComponents:
      - rke2-ingress-nginx
    snapshotScheduleCron: "0 */12 * * *"
    snapshotRetention: 5
    secretsEncryption: true

# Node Pools - ALL PRIVATE (no public IPs, access via bastion)
nodePools:
  # MASTERS: 1 DigitalOcean
  do-masters:
    count: 1
    provider: digitalocean
    region: nyc3
    size: s-2vcpu-4gb
    image: ubuntu-24-04-x64
    roles:
      - master
    labels:
      node-role: "master"
      cloud: "digitalocean"

  # MASTERS: 2 Linode
  linode-masters:
    count: 2
    provider: linode
    region: us-ord
    size: g6-standard-2
    image: linode/ubuntu24.04
    roles:
      - master
    labels:
      node-role: "master"
      cloud: "linode"

  # WORKERS: 2 DigitalOcean
  do-workers:
    count: 2
    provider: digitalocean
    region: nyc3
    size: s-4vcpu-8gb
    image: ubuntu-24-04-x64
    roles:
      - worker
    labels:
      node-role: "worker"
      cloud: "digitalocean"

  # WORKERS: 1 Linode
  linode-workers:
    count: 1
    provider: linode
    region: us-ord
    size: g6-standard-4
    image: linode/ubuntu24.04
    roles:
      - worker
    labels:
      node-role: "worker"
      cloud: "linode"

sshKey:
  name: sloth-k8s-key
  publicKeyPath: ~/.ssh/id_rsa.pub
  privateKeyPath: ~/.ssh/id_rsa

# ArgoCD GitOps Addon Configuration
addons:
  argocd:
    enabled: true
    version: stable
    namespace: argocd
    gitopsRepoUrl: https://github.com/chalkan3/kubernetes-gitops-infrastructure
    gitopsRepoBranch: main
    appsPath: argocd/apps
